{layout='layouts/_main-wrapper'}


<!-- Page Feature -->
<div class="page_feature">
	<div class="page_header">
		<div class="page_header_inner">
			<div class="page_header_body">
				<div class="breadcrumb">
					<div class="fs-row">
						<div class="fs-cell">
							<div class="breadcrumb_inner">
								

<nav class="breadcrumb_nav" aria-labelledby="breadcrumb_nav_title">
	<div class="breadcrumb_nav_header">
		<h2 class="breadcrumb_nav_title" id="breadcrumb_nav_title">You are here:</h2>
	</div>
	<ol class="breadcrumb_list" aria-labelledby="breadcrumb_nav_title">
		<li class="breadcrumb_item breadcrumb_item_home">
			<a class="breadcrumb_pill breadcrumb_pill_link" href="/">
				<span class="breadcrumb_pill_inner">
										<span class="breadcrumb_pill_label">Home</span>
					<span class="breadcrumb_pill_icon">
			<svg class="icon icon_caret_right">
				<use href="/images/icons.svg#caret_right" />
			</svg>
		</span>
				</span>
			</a>
					</li>
					
					{!--<li class="breadcrumb_item">
				<a class="breadcrumb_pill breadcrumb_pill_link" href="/major">
					<span class="breadcrumb_pill_inner">
						<span class="breadcrumb_pill_label">Class Schedule</span>
						<span class="breadcrumb_pill_icon">
			<svg class="icon icon_caret_right">
				<use href="/images/icons.svg#caret_right" />
			</svg>
		</span>
					</span>
				</a>
							</li>
					<li class="breadcrumb_item">
				<a class="breadcrumb_pill breadcrumb_pill_link" href="#">
					<span class="breadcrumb_pill_inner">
						<span class="breadcrumb_pill_label">Parent Level</span>
						<span class="breadcrumb_pill_icon">
			<svg class="icon icon_caret_right">
				<use href="/images/icons.svg#caret_right" />
			</svg>
		</span>
					</span>
				</a>
							</li>--}
				<li class="breadcrumb_item">
			<span class="breadcrumb_pill">
				<span class="breadcrumb_pill_inner">
					<span class="breadcrumb_pill_label">Page Title</span>
				</span>
			</span>
					</li>
	</ol>
</nav>
							</div>
						</div>
					</div>
				</div>
				<div class="page_intro">
					<div class="fs-row">
						<div class="fs-cell fs-lg-10 fs-xl-9">
							<div class="page_intro_inner">
								<h1 class="page_title" itemprop="name">Class Schedule</h1>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- END: Page Feature -->

<?php
include("includes/courses_conn.php");

	$default_term = "courses_spring";

	echo '<script type="text/javascript">
		function termSelected(){
			if (document.getElementById("term_fall").selected == true){		
				document.getElementById("fall").style.display = "block";	
				document.getElementById("spring").style.display = "none";
				document.getElementById("summer").style.display = "none";	
				document.getElementById("fall2").style.display = "block";	
				document.getElementById("spring2").style.display = "none";
				document.getElementById("summer2").style.display = "none";
				document.getElementById("location").style.display = "none";
				document.getElementById("online").style.display = "none";
				document.getElementById("fall20spring21").style.display = "block";
				document.getElementById("searchByDays").style.display = "block";
			}
			if (document.getElementById("term_spring").selected == true){		
				document.getElementById("fall").style.display = "none";	
				document.getElementById("spring").style.display = "block";
				document.getElementById("summer").style.display = "none";
				document.getElementById("fall2").style.display = "none";	
				document.getElementById("spring2").style.display = "block";
				document.getElementById("summer2").style.display = "none";
				document.getElementById("location").style.display = "none";
				document.getElementById("online").style.display = "none";
				document.getElementById("fall20spring21").style.display = "block";
				document.getElementById("searchByDays").style.display = "block";
			} 
			if (document.getElementById("term_summer").selected == true){ 
				document.getElementById("fall").style.display = "none";	
				document.getElementById("spring").style.display = "none";
				document.getElementById("summer").style.display = "block";
				document.getElementById("fall2").style.display = "none";	
				document.getElementById("spring2").style.display = "none";
				document.getElementById("summer2").style.display = "block";
				document.getElementById("location").style.display = "none";
				document.getElementById("online").style.display = "block";
				document.getElementById("fall20spring21").style.display = "none";
				document.getElementById("searchByDays").style.display = "none";
			}
		}
		
		function reset_form() {
			document.getElementById("schedule").reset(); 		
		}	
	</script>';

	$fall_term_result = mysqli_query($conn, "SELECT DISTINCT term FROM courses_fall");
	$fall_term_row = mysqli_fetch_assoc($fall_term_result);
	$fall = explode(" ", $fall_term_row["term"]);
	$fall_term = $fall[1] . ' ' . $fall[0];

	$spring_term_result = mysqli_query($conn, "SELECT DISTINCT term FROM courses_spring");
	$spring_term_row = mysqli_fetch_assoc($spring_term_result);
	$spring = explode(" ", $spring_term_row["term"]);
	$spring_term = $spring[1] . ' ' . $spring[0];

	$summer_term_result = mysqli_query($conn, "SELECT DISTINCT term FROM courses_summer");
	$summer_term_row = mysqli_fetch_assoc($summer_term_result);
	$summer = explode(" ", $summer_term_row["term"]);
	$summer_term = $summer[1] . ' ' . $summer[0];
	
	$fall_subject_query = "SELECT DISTINCT academic_subject FROM courses_fall WHERE location NOT LIKE 'CCWA%' ORDER BY academic_subject";
	$spring_subject_query = "SELECT DISTINCT academic_subject FROM courses_spring WHERE location NOT LIKE 'CCWA%' ORDER BY academic_subject";
	$summer_subject_query = "SELECT DISTINCT academic_subject FROM courses_summer WHERE location NOT LIKE 'CCWA%' ORDER BY academic_subject";

	$fall_subject_result = mysqli_query($conn, $fall_subject_query);
	$spring_subject_result = mysqli_query($conn, $spring_subject_query);
	$summer_subject_result = mysqli_query($conn, $summer_subject_query);

	$fall_session_query = "SELECT DISTINCT session FROM courses_fall WHERE location NOT LIKE 'CCWA%'";
	$spring_session_query = "SELECT DISTINCT session FROM courses_spring WHERE location NOT LIKE 'CCWA%'";
	$summer_session_query = "SELECT DISTINCT session FROM courses_summer WHERE location NOT LIKE 'CCWA%'";

	$fall_session_result = mysqli_query($conn, $fall_session_query);
	$spring_session_result = mysqli_query($conn, $spring_session_query);
	$summer_session_result = mysqli_query($conn, $summer_session_query);

	mysqli_close($conn);

	$show = 'style="display:block"';
	$hide = 'style="display:none"';
?>

<div class="full_width_callouts">
	<div class="filter">
	<div class="filter_tabs" role="tablist" aria-label="Class Schedule Filtering">
		<div class="fs-row">
			<div class="fs-cell">
				<div class="filter_tabs_inner">
					<button class="js-swap filter_tab" role="tab" data-swap-target=".filter_tabpanel_tools" data-swap-group="filter_tabs"  data-swap-options='{"collapse": false}'>Search</button>
				</div>
			</div>
		</div>
	</div>
	<div class="filter_panels">
	<form class="filter_tools" action="/schedule/search" method="post">
		<div class="fs-row">
			<div class="fs-cell">
				<div class="filter_panels_inner">
					<div class="filter_tabpanel filter_tabpanel_tools" role="tabpanel">
	
	<div class="fs-row">
	<div class="fs-cell fs-lg-4">
		<div class="filter_tool">
			<div class="filter_tool_select_wrapper">
				<select class="filter_tool_select" name="term" id="term" onchange="termSelected();">
				<?php 
				echo '<option id="term_fall" value="courses_fall"'; if ($default_term == 'courses_fall'){echo ' selected="selected"'; } echo '>' . $fall_term . '</option>
				<option id="term_spring" value="courses_spring"'; if ($default_term == 'courses_spring'){echo ' selected="selected"'; } echo '>' . $spring_term . '</option>	
				<option id="term_summer" value="courses_summer"'; if ($default_term == 'courses_summer'){echo ' selected="selected"'; } echo '>' . $summer_term . '</option>';
				?>
				</select>
				<span class="filter_tool_select_icon">
					<svg class="icon icon_caret_down">
					<use href="/images/icons.svg#caret_down" />
					</svg>
				</span>
			</div>
		</div>
		<div class="filter_tool">
			<div class="filter_tool_select_wrapper">
			<?php 
				echo '<div name="fall" id="fall" ';  if ($default_term == 'courses_fall') {echo $show; } else {echo $hide; } echo '>';
				echo '<select class="filter_tool_select" name="fall_subject" id="fall_subject">
				<option value="" selected>All Subjects</option>';
				while ($subject_row = mysqli_fetch_array($fall_subject_result)) { 
					echo '<option value="' . $subject_row[0] . '">' . $subject_row[0] . '</option>';
				}
				echo '</select></div>';
				echo '<div name="spring" id="spring" ';  if ($default_term == 'courses_spring') {echo $show; } else {echo $hide; } echo '>';
				echo '<select class="filter_tool_select" name="spring_subject">
				<option value="" selected>All Subjects</option>';
				while ($subject_row = mysqli_fetch_array($spring_subject_result)) { 
					echo '<option value="' . $subject_row[0] . '">' . $subject_row[0] . '</option>';
				}
				echo '</select></div>';
				echo '<div name="summer" id="summer" ';  if ($default_term == 'courses_summer') {echo $show; } else {echo $hide; } echo '>';
				echo '<select class="filter_tool_select" name="summer_subject">
				<option value="" selected>All Subjects</option>';
				while ($subject_row = mysqli_fetch_array($summer_subject_result)) { 
					echo '<option value="' . $subject_row[0] . '">' . $subject_row[0] . '</option>';
				}
				echo '</select></div>';
			?>
				<span class="filter_tool_select_icon">
					<svg class="icon icon_caret_down">
						<use href="/images/icons.svg#caret_down" />
					</svg>
				</span>
			</div>
		</div>
	</div><!-- end fs-cell fs-lg-4 -->
</div>
<div class="fs-row">
	<div class="fs-cell fs-lg-4">
		<div class="filter_tool">
			<div class="filter_tool_select_wrapper">
			<?php 
				echo '<div name="location" id="location" ';  if ($default_term != 'courses_summer' && $default_term != 'courses_fall' && $default_term != 'courses_spring') {echo $show; } else {echo $hide; } echo '>';	
				echo '<select class="filter_tool_select" name="campus">
						<option value="" selected>All Locations</option>
						<option value="Chester Campus">Chester Campus</option>
						<option value="Midlothian Campus">Midlothian Campus</option>
						<option value="Virtual">Virtual</option>						
					</select>';
				echo '</div>';
				echo '<div name="online" id="online" ';  if ($default_term == 'courses_summer') {echo $show; } else {echo $hide; } echo '>';	
				echo '<select class="filter_tool_select" name="online-format">
						<option value="">All Online Formats</option>
						<option value="hybrid">Video-enhanced classes</option>
						<option value="non-hybrid">Virtual classes</option>						
					</select>';
				echo '</div>';
				echo '<div name="fall20spring21" id="fall20spring21" ';  if ($default_term != 'courses_summer') {echo $show; } else {echo $hide; } echo '>';	
				echo '<select class="filter_tool_select" name="class-format">
						<option value="">All Class Formats</option>
						<option value="Virtual">Virtual</option>
						<option value="Zoom">Zoom Classes</option>
						<option value="Hybrid_zoom">Hybrid: Virtual and Zoom</option>
						<option value="Hybrid_campus">Hybrid: Virtual/Zoom and On Campus</option>
						<option value="Chester">On Campus: Chester</option>
						<option value="Midlothian">On Campus: Midlothian</option>
					</select>
				</div>';
			?>
				<span class="filter_tool_select_icon">
					<svg class="icon icon_caret_down">
						<use href="/images/icons.svg#caret_down" />
					</svg>
				</span>
			</div>
		</div>
	</div>
	<div class="fs-cell fs-lg-8">
		<div class="filter_tool">
			<div class="filter_tool_select_wrapper">
			<?php 
				echo '<div name="fall2" id="fall2" ';  if ($default_term == 'courses_fall') {echo $show; } else {echo $hide; } echo '>';
				echo '<select class="filter_tool_select" name="fall_session">
					<option value="" selected>All Sessions</option>';
				while ($session_row = mysqli_fetch_array($fall_session_result)) { 
					echo '<option value="' . $session_row[0] . '">' . $session_row[0] . '</option>';
				}
				echo '</select>';	
				echo '</div>';
				echo '<div name="spring2" id="spring2" ';  if ($default_term == 'courses_spring') {echo $show; } else {echo $hide; } echo '>';
				echo '<select class="filter_tool_select" name="spring_session">
					<option value="" selected>All Sessions</option>';
				while ($session_row = mysqli_fetch_array($spring_session_result)) { 
					echo '<option value="' . $session_row[0] . '">' . $session_row[0] . '</option>';
				}
				echo '</select>';	
				echo '</div>';
				echo '<div name="summer2" id="summer2" ';  if ($default_term == 'courses_summer') {echo $show; } else {echo $hide; } echo '>';
				echo '<select class="filter_tool_select" name="summer_session">
					<option value="" selected>All Sessions</option>';
				while ($session_row = mysqli_fetch_array($summer_session_result)) { 
					echo '<option value="' . $session_row[0] . '">' . $session_row[0] . '</option>';
				}
				echo ' <option value="maymester">Maymester: May 15 – June 7</option>';
				echo '</select>';	
				echo '</div>';
			?>
				<span class="filter_tool_select_icon">
					<svg class="icon icon_caret_down">
						<use href="/images/icons.svg#caret_down" />
					</svg>
				</span>
			</div>
		</div>
	</div><!-- end fs-cell fs-lg-4 -->
</div>
<div class="fs-row">
	<div class="fs-cell fs-lg-4">
		<div class="filter_tool">
			<div class="filter_tool_select_wrapper">
			<?php 
				//echo '<div name="searchByDays" id="searchByDays" ';  if ($default_term != 'courses_summer') {echo $show; } else {echo $hide; } echo '>';
				echo '<select class="filter_tool_select" name="select_days">
						<option value="" selected>All Days</option>
						<option value="M">M</option>
						<option value="Tu">Tu</option>
						<option value="W">W</option>
						<option value="Th">Th</option>
						<option value="F">F</option>
						<option value="MW">MW</option>
						<option value="TuTh">TuTh</option>
						<option value="Sa">Sa</option>
						<option value="Other">Other</option>						
					</select>';
				//echo '</div>';
			?>
				<span class="filter_tool_select_icon">
					<svg class="icon icon_caret_down">
						<use href="/images/icons.svg#caret_down" />
					</svg>
				</span>
			</div>
		</div>
		<div class="filter_tool">
			<input type="hidden" name="XID" value="{XID_HASH}" />
			<button class="filter_tools_submit filter_tools_submit_tools" type="submit" name="dir_sbmt">
				<span class="filter_tools_submit_label">Submit</span>
				<span class="filter_tools_submit_icon">
					<svg class="icon icon_caret_right">
						<use href="/images/icons.svg#caret_right" />
					</svg>
				</span>
			</button>
		</div>
	</div></div><!-- end fs-cell, fs-row -->
	
					</div>
				</div>
			</div>
		</div>
		</form>
	</div>

<!-- Full Width Callouts -->
<div class="full_width_callouts">
    <div class="wysiwyg_block">
        <div class="fs-row">
            <div class="fs-cell">
                <div class="wysiwyg_block_inner typography">
	

<?php 
if($_SERVER['REQUEST_METHOD'] == "POST") { 
		$host = "164.106.55.222"; //database location external
//$host = "10.70.200.12"; //database location internal
//$host = "apps.jtcc.edu"; //database location
$user = "diruser"; //database username
$pass = "J20tcc17#"; //database password
$db_name = "jtccdirdb"; //database name

//database connection
$con = mysqli_connect($host, $user, $pass, $db_name);
if (mysqli_connect_errno()){
	echo "Failed to connect to database.";
}

        $FName = mysqli_real_escape_string($con, $_POST['fname']);
        $LName = mysqli_real_escape_string($con, $_POST['lname']);
        $Dept  = $_POST['dept'];
            		
            		$sql = "SELECT 	tblemp.StateID,
                                    tblemp.Prefix, 
                                    tblemp.FName, 
                                    tblemp.MName, 
                                    tblemp.LName,
                                    tblemp.Nickname,
                                    tblemp.Suffix, 
            						tblemp.Email,
                                    tblemp.WTitleID,
            						tbllkwtitle.WorkTitle,
                                    tblemp.DeptID,
                                    tblemp.DivID,
            						tbllkdiv.DivDesc,         
                                    tbllkdept.Dept,
            						tblacaddeptdiv.ADept,
                                    tblacaddeptdiv.AcadDeptID
                            FROM tblemp
                            LEFT OUTER JOIN tbllkwtitle
                            USING (WTitleID)
                            Left outer join tbllkdiv
                            USING (DivID)
                            LEFT OUTER JOIN tbllkdept
                            USING (DeptID)
                            LEFT OUTER JOIN tblacaddeptdis
                            USING (DeptID)
                            LEFT OUTER JOIN tblacaddeptdiv 
                            USING (AcadDeptID)
                            WHERE 1 = 1";    
                    if (strlen($FName) > 0) {
                      	$sql .= " AND (tblemp.FName LIKE '$FName%'
            					OR tblemp.Nickname LIKE '$FName%')";
                    }
                    if (strlen($LName) > 0) {
                    	$sql .= " AND tblemp.LName LIKE '$LName%'";
                    }    
                    if ($Dept != "") {
                    	$sql .= " AND (tbllkdept.Dept = '$Dept' OR tblacaddeptdiv.ADept = '$Dept')";
                    }       		
                    $sql .= " ORDER BY LName, FName";

                    $result = mysqli_query($con, $sql);
            		
                    
                	if (mysqli_num_rows($result)) {
            			while ($row = mysqli_fetch_assoc($result)) {
            				$sID = $row['StateID'];
                        	$getLoc = "SELECT StateID, Building, Room, PACode, PExt, Phone, FACode, FExt, FAX, Location
                                        FROM tblemploc
                                        LEFT OUTER JOIN tbllocbuild
                                        USING (BuildID)
                                        LEFT OUTER JOIN tbllkloc
                                        USING (LocID)
                                        WHERE StateID = '$sID'
                                        ORDER BY StateID, Location";
                            $getLoc_result = mysqli_query($con, $getLoc);
                            
                            
                            echo '<h3>';            
            				echo $row['Prefix']; 
                            if (strlen(trim($row['Nickname'])) > 0) {
                            	echo ' ' . $row['Nickname'];
                            } else {
                            	echo ' ' . $row['FName'];
                            }
                            echo ' ' . $row['LName'] . '</h3>';
                            echo '<h4>' . $row['WorkTitle'] . '</h4>';
                            echo '<p>';
                            if ($row['DivID'] != 17) {
                            	echo $row['DivDesc'] . '<br />';
                            }
                            /*if (strlen(trim($row['ADept'])) > 0) {
                            	echo $row['ADept'] . '<br />';
                            } 
                            if ($row['ADept'] != $row['Dept']) {
                            	echo $row['Dept'] . '<br />';
                            }*/
                            if (strlen(trim($row['ADept'])) > 0) {
                            	echo $row['ADept'] . '<br />';
                            } else {
                            	if (strlen(trim($row['Dept'])) > 0) {
                            		echo $row['Dept'] . '<br />';
                            	}
                            }
                            /*if (strlen($row['Email']) > 0) {
                            	echo '<a href="mailto:' . $row['Email'] . '">' . $row['Email'] . '</a>';
                            }*/
                            echo '</p>';
                            if (mysqli_num_rows($getLoc_result) > 0) {
                            	while ($loc_row = mysqli_fetch_assoc($getLoc_result)) {
                            		echo '<p>';
                                	if (strlen($loc_row['Location']) > 0) {
                                		//echo '<h6>' . strtoupper($loc_row['Location']) . '</h6>';
                                		echo $loc_row['Location'] . '<br />';
                                    }
                                    if (strlen($loc_row['Room']) > 0 && $loc_row['Room'] != '0') {
                                        echo $loc_row['Room'] . ', ';
                                    }
                                    if (strlen($loc_row['Building']) > 0) {
                                        echo $loc_row['Building'];
                                    }
                                    echo '<br />';
                                    if (strlen($loc_row['PACode']) > 0) {
                                    	echo 'Phone: ' . $loc_row['PACode'] . '-' . $loc_row['PExt'] . '-' . $loc_row['Phone'] . '<br />';
                                    }
                                    if (strlen($loc_row['FACode']) > 0) {
                                    	echo 'Fax: ' . $loc_row['FACode'] . '-' . $loc_row['FExt'] . '-' . $loc_row['FAX'] . '<br />';
                                    }
                                    //echo '<p>';
                                }
                                mysqli_free_result($getLoc_result);
                                //unset($loc_row);
                            }
                            if (strlen($row['Email']) > 0) {
                            	echo '<a href="mailto:' . $row['Email'] . '">' . $row['Email'] . '</a>';
                            }
                            echo '<p>';
                    		echo '<hr />';
                    	}
            			mysqli_free_result($result);
                   		//unset($row);        
                    } else {
                    	echo 'No record found. Please try it again.'; 
                    }
                   mysqli_close($con); 
            	} 
            ?>
            
            <p>Need general information? Call our Student Information Center at 804-796-4000.</p>
        	</div>
    	</div>
     </div>
   </div>
</div>  
<!-- end full_width_callouts -->     
