<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M7KGFM5');</script>
<!-- End Google Tag Manager -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JTCC Courses</title>

	<link rel="stylesheet" href="/assets/stylesheets/mobile-theme.min.css" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile.structure-1.3.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>

	<style>
		.ui-li-desc {
		font-size: 12px;
		font-weight: 400;
		display: block;
		margin: -.5em 0 .6em;
		text-overflow: clip;
		overflow: none;
		white-space: normal;
	</style>

</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M7KGFM5"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div data-role="page">	
  
    <div data-role="header" data-position="fixed">
       <h1>JTCC Courses Search Results</h1>
    </div>

	<div data-role="content" data-theme="a">
		
		
	<?php
		include("includes/courses_conn.php");
	
		//ini_set('session.cache_limiter', 'private');

		date_default_timezone_set('America/New_York');

		$today = date("m/d/Y");
         
	if (isset($_POST['term'])) {
    	$term		= $_POST['term'];
	} else { 
		header('Location:http://www.jtcc.edu/mobile/courses');	
		die();
	}	
	$campus = '';
	if (isset($_POST['campus'])) { 	
		$campus		= $_POST['campus'];
	}
	$select_days ='';
	if (isset($_POST['select_days'])) { 
		$select_days		= $_POST['select_days'];
	}
	$online = '';
	if (isset($_POST['online-format'])) {
		$online 	= $_POST['online-format'];
	}
	$fall20spring21 = '';
	if (isset($_POST['class-format'])) {
		$fall20spring21 	= $_POST['class-format'];
	}	
		
		if (substr($term,8,4) == 'fall') {
			$subject	= $_POST['fall_subject'];
			$session	= $_POST['fall_session'];
			//$last_modified = filemtime("JTWEBCRSECAT_FALL.CSV");
		} elseif (substr($term,8,4) == 'spri') {
			$subject	= $_POST['spring_subject'];
			$session	= $_POST['spring_session'];
			//$last_modified = filemtime("JTWEBCRSECAT_SPRING.CSV");
		} elseif (substr($term,8,4) == 'summ') {
			$subject	= $_POST['summer_subject'];
			$session	= $_POST['summer_session'];
			//$last_modified = filemtime("JTWEBCRSECAT_SUMMER.CSV");
		}
	
		// build the search query 	
		$search_query = "SELECT distinct term, campus, academic_subject, session, subject, catalog, section, units, title, class_nbr, TRIM(pre_note) AS pre_note, TRIM(note) AS note, location, start_date, end_date, enrl_stat, last_enrl_date, strm, dt_drop_without_penalty, dt_drop_with_penalty 
						FROM " . $term . " WHERE location NOT LIKE 'CCWA%'";
		/*if ($subject != "") { 
			$search_query.= " AND academic_subject LIKE \"%$subject%\"";
		}*/
		if ($subject != "") { 
			$search_query.= " AND academic_subject = '$subject'";
		}

		if ($campus == "Virtual") {
			$search_query.=	" AND location LIKE \"%VIRTUAL%\"";
		} else {
			if ($campus != "") {
				$search_query.=	" AND campus LIKE \"%$campus%\"";
			}
		}

		if ($online != "") {
			if ($online == "hybrid") {
				$search_query.=	" AND section LIKE \"R%\"";
			} else {
				$search_query.=	" AND section NOT LIKE \"R%\"";
			}
		}

		if ($fall20spring21 != "") { 
			switch ($fall20spring21) {
				case 'Chester':
					$search_query.=	" AND section not like 'N%' and section not like 'R%' and section not like 'Z%' and section not like 'M%' and section not like 'SW%' and section not like 'NV%' and section not like 'JT%' and section not like 'ME%'";
					break;
				case 'Midlothian':
					$search_query.=	" AND section like 'M%'";
					break;
				case 'Hybrid_campus':
					$search_query.=	" AND section like 'R%' AND section not like '%S'";
					break;
				case 'Hybrid_zoom':
					$search_query.=	" AND section like 'R%S'";
					break;
				case 'Virtual':
					$search_query.=	" AND (section like 'N%' OR (location != 'VIRTUAL-RT' and (section like 'SW%' OR section like 'NV%' OR section like 'JT%' OR section like 'ME%')))";
					break;
				case 'Zoom':
					$search_query.=	" AND (section like 'Z%' OR (pat != 'VIRT' and (section like 'NV%' OR section like 'JT%')))";
			}
		}

		if ($session != "") {
			if ($session == "maymester") {
				$search_query.=	" AND (pre_note LIKE \"%Maymester%\" OR note LIKE \"%Maymester%\")";
			} else {
				$search_query.=	" AND session LIKE \"%$session%\"";
			}
		}

		if ($select_days !== "") {
			if ($select_days == 'Other') {
				$search_query.= " AND location != 'VIRTUAL' AND pat != 'VIRT' AND days NOT IN ('M','Tu','W','Th','F','MW','TuTh','Sa')";
			} else {
				$search_query.= " AND days = '$select_days'";
			}
		}
		
		$search_query.=	" ORDER BY subject, catalog, location, section";				// IMPORTANT keeps all results sorted as desired
		
		$search_result = mysqli_query($conn, $search_query) or die("Unable to process search query.");
		$search_num = mysql_num_rows($search_result);
		//mysql_close($conn);
		
		/*echo '<p><strong>Abbreviations</strong></p>
				<ul>
					<li>This schedule uses conventional abbreviations for days of the week (<strong>Su M Tu W Th F Sa</strong>).</li>
					<li>The following abbreviations are used in section numbers (the last group in the Course field):
						<ul style="list-style-type: none;">
							<li><strong>E:</strong> Dual Enrollment</li>
							<li><strong>J:</strong> JTNEC (JTCC Nursing Education Center)</li>
							<li><strong>M:</strong> Midlothian</li>
							<li><strong>N:</strong> Online (instruction by Internet only)</li>
							<li><strong>P:</strong> Professional Development (enrollment open to everyone)</li>
							<li><strong>R:</strong> Hybrid course (Internet and mandatory class meetings)</li>
							<!--<li><strong>W:</strong> Weekend College</li>-->
						</ul>
					</li>
				</ul>';*/
		
	
		if ($search_num > 0){
			$i=0;																				
			while ($i < $search_num) {			
				$semester	= explode(" ", mysql_result($search_result, $i, "term"));
				$campus		= mysql_result($search_result, $i, "campus");
				//$academic_subject	= mysql_result($search_result, $i, "academic_subject");
				$units		= mysql_result($search_result, $i, "units");	
				$section	= mysql_result($search_result, $i, "section");
				$subject	= mysql_result($search_result, $i, "subject");
				$catalog	= mysql_result($search_result, $i, "catalog");
				$title		= mysql_result($search_result, $i, "title");
				$class_nbr	= mysql_result($search_result, $i, "class_nbr");
				$pre_note	= mysql_result($search_result, $i, "pre_note");
				$note		= mysql_result($search_result, $i, "note");
				$start_date	= date("n/j/Y", strtotime(mysql_result($search_result, $i, "start_date")));
				$end_date	= date("n/j/Y", strtotime(mysql_result($search_result, $i, "end_date")));	
				//$session	= str_replace("Academic ", "", mysql_result($search_result,$i,"session"));
				$session2	= mysql_result($search_result, $i, "session");
				$location	= mysql_result($search_result, $i, "location");	
				$status		= mysql_result($search_result, $i, "enrl_stat");
				//$term_id	= mysql_result($search_result, $i, "term");
				$term_id	= mysql_result($search_result, $i, "strm");
				
				$termbkstr  = $semester[1] . '+' . $semester[0];
				$campusbkstr      = str_replace(" Campus", "", $campus);
				if ($campusbkstr == 'Midlothian') {
					$bookstore_id = '1400';
				} else {
					$bookstore_id = '1399';
				}
				
		
				if ($start_date != '12/31/1969') {
					$session = $start_date.' - '.$end_date;										// display actual dates for non-regular sessions
				} else {
					$session = 'Session: N/A';
				}
			
				/*if ($location === 'CHESTECH' || $location === 'CHESTERFLD' || $location === 'MIDLO/OC 0'){
					$location = "OFF-SITE";
				} 
				elseif ($location === 'MIDLO  004'){
					$location = "MIDLOTHIAN";
				}*/

				switch($location) {
					case "CHESTECH": $location = "Chesterfield Technical Center"; break;
					case "CHESTER": $location = "Chester Campus"; break;
					case "CHESTERFLD": $location = "Chesterfield Off Campus "; break;
					case "JTCJW": $location = "Nursing Education Center"; break;
					case "MIDLO  004": $location = "Midlothian Campus"; break;
					case "MIDLO/OC 0": $location = "Midlothian Off Campus"; break;
					case "VIRTUAL": $location = "Virtual"; break;
				}	

				if ($status == 'O') {
					$status = 'Open';
				} elseif ($status == 'C') {
					$status = 'Closed';
				} 
				$last_enrl_date = date("m/d/Y", strtotime(mysql_result($search_result, $i, "last_enrl_date")));
				if ($last_enrl_date != '12/31/1969') {
					if (strtotime($today) > strtotime($last_enrl_date)) {
						$status = 'Closed';
					}
				} else {
					$last_enrl_date = 'N/A';
				}
				if (trim($session2) == 'Dynamic Session') {
					$last_enrl_date = 'N/A';
				}
				$dt_drop_without_penalty = date("n/j/Y", strtotime(mysql_result($search_result, $i, "dt_drop_without_penalty")));
				if ($dt_drop_without_penalty == '12/31/1969' OR $dt_drop_without_penalty == '11/30/-0001') {
					$dt_drop_without_penalty = 'N/A';
				}
				$dt_drop_with_penalty = date("n/j/Y", strtotime(mysql_result($search_result, $i, "dt_drop_with_penalty")));	
				if ($dt_drop_with_penalty == '12/31/1969' OR $dt_drop_with_penalty == '11/30/-0001') {
					$dt_drop_with_penalty = 'N/A';
				}	
		
				$query2 = "SELECT location, pat, days, start, end, room, name FROM " . $term . " WHERE class_nbr =" . $class_nbr . " ORDER BY pat";
				$query2_result = mysql_query($query2) or die("Unable to process search query.");
				$query2_num = mysql_numrows($query2_result);
	
				echo '<ul data-role="listview" data-inset="true">';
					echo '<li><h2>' . $subject . ' ' . $catalog . ' ' . $section . ' (' . $class_nbr . ')</h2>';
					echo '<p style="text-overflow: clip; overflow: none; white-space: normal;">' . $title . '</p>';
					echo '<p><a href="/mobile/course_description/' . trim($subject) . trim($catalog) . '">Course description</a></p>';
					echo '<p>Credits: ' . $units . '</p>';

					$j = 0;
					while ($j < $query2_num) {	
						$pat		= mysql_result($query2_result, $j, "pat");
						//$location	= mysql_result($query2_result, $j, "location");
						$days		= mysql_result($query2_result, $j, "days");
						$start		= trim(mysql_result($query2_result, $j,"start"));	
						$end		= trim(mysql_result($query2_result, $j,"end"));
						$room		= mysql_result($query2_result, $j, "room");
						$instructor	= mysql_result($query2_result, $j, "name");
				
						/*if ((strpos($pat, "VIRT") !== FALSE) || (strpos($location, "VIRTUAL") !== FALSE)) {
							$pat = "VIRT";
							$days = "Virtual";
							$times = "N/A";
						}
						else {
							$times = $start." - ".$end;
						}*/

						if ($pat == "VIRT") {
							//$location = "Virtual";
							$days = "Virtual";
							$times = "";
							$room = "online";
						}
						else {
							/*switch($location) {
								case "CHESTECH": $location = "Chesterfield Technical Center"; break;
								case "CHESTER": $location = "Chester Campus"; break;
								case "CHESTERFLD": $location = "Chesterfield Off Campus "; break;
								case "JTCJW": $location = "Nursing Education Center"; break;
								case "MIDLO  004": $location = "Midlothian Campus"; break;
								case "MIDLO/OC 0": $location = "Midlothian Off Campus"; break;
								//case "VIRTUAL": $location = "Online"; break;
							}*/
							$times = $start." - ".$end;
						}

						if ($term == 'courses_summer' && strlen($start)) {						
							$times = $times . ', Zoom';
						}
				
						echo '<p>' . $days . ' ' . $times . '</p>';	
						echo '<p>(' .$room . ', ' . $instructor . ')</p>';	
						$j++;
					}
						
					echo '<p style="text-overflow: clip;overflow: none; white-space: normal;">' . $location . ', ' . $session . '</p>';
					echo '<p style="text-overflow: clip;overflow: none; white-space: normal;">Last day to add: ' . $last_enrl_date . '</p>';
					echo '<p style="text-overflow: clip;overflow: none; white-space: normal;">Last day to drop w/refund: ' . $dt_drop_without_penalty . '</p>';
					echo '<p style="text-overflow: clip;overflow: none; white-space: normal;">Last day to withdraw: ' . $dt_drop_with_penalty . '</p>';
					echo '<p style="text-overflow: clip;overflow: none; white-space: normal;">' . $pre_note . $note . '</p>';
					echo '<p>Class Status: ' . $status . '</p>';
					/*echo '<p><a target="_blank" href="http://www.jtccbooks.com/chester/textbook_express/get_txtexpress.asp?remote=1&amp;ref=2394&amp;student=&amp;term=' . trim($termbkstr) . '&amp;dept=' . trim($subject) . '&amp;course=' . trim($catalog) . '&amp;section='. trim($section) . '&amp;getbooks=Display+books">Textbooks</a></p>';*/
					echo '<p><a href="http://www.bkstr.com/webapp/wcs/stores/servlet/booklookServlet?bookstore_id-1=' . $bookstore_id . '&amp;term_id-1=' . trim($term_id) . '&amp;div-1=&amp;dept-1=' . trim($subject) . '&amp;course-1=' . trim($catalog) . '&amp;section-1=' . trim($section) . '">Textbooks</a></p>';
					/*echo '<p><a href="http://www.bkstr.com/webapp/wcs/stores/servlet/booklookServlet?bookstore_id-1=' . $bookstore_id . '&amp;term_id-1=2154&amp;div-1=&amp;dept-1=' . trim($subject) . '&amp;course-1=' . trim($catalog) . '&amp;section-1=' . trim($section) . '">Textbooks</a></p>';*/
					echo '</li></ul>';	
					$i++;
				}
				mysqli_close($conn);
		} else {
			echo '<p>No record was found for this search.</p>';
		}
	?>
	
	</div><!--end content-->
    	
	<!--<div data-role="footer">
	       
	</div>-->

</div><!--end page-->

{!--{embed="mobile/google_analytics"} --}

</body>
</html>